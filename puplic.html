<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grand Ã‰cran - Challenge MÃ©dical ğŸ—ï¸</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary-gradient: linear-gradient(45deg, #9c27b0, #e91e63);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --text-white: #ffffff;
        }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden; /* Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙˆØ¶Ù…Ø§Ù† Ø«Ø¨Ø§Øª Ø§Ù„ØµÙØ­Ø© */
            font-family: 'Poppins', sans-serif;
            color: var(--text-white);
        }

        /* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø«Ø§Ø¨ØªØ© ÙˆØ§Ù„ÙˆØ­ÙŠØ¯Ø© */
        .main-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('bg.jpg') no-repeat center center;
            background-size: cover;
            z-index: -1;
        }

        /* Ø§Ù„Ù„ÙˆØ¬Ùˆ Ø§Ù„Ø«Ø§Ø¨Øª */
        .logo-fixed-container {
            position: absolute;
            top: 25px;
            left: 30px;
            z-index: 1000;
            padding: 5px;
            background: var(--primary-gradient);
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(156, 39, 176, 0.6);
            animation: glowPulse 3s infinite ease-in-out;
        }

        .logo-fixed-container img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid white;
            display: block;
        }

        /* Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .screen-layer {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
        #welcome-overlay {
            z-index: 500;
            background: rgba(0, 0, 0, 0.4); /* ØªØ¹ØªÙŠÙ… Ø®ÙÙŠÙ Ø¬Ø¯Ø§Ù‹ */
            backdrop-filter: blur(8px);
        }

        .welcome-card {
            background: var(--glass-bg);
            padding: 50px;
            border-radius: 40px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            max-width: 800px;
        }

        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙƒÙˆÙŠØ² */
        #quiz-interface {
            opacity: 0;
            pointer-events: none;
            z-index: 400;
            transform: translateY(30px);
        }

        #quiz-interface.active {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0);
        }

        /* Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø¨ÙŠØ¶ Ø§Ù„Ù†Ù‚ÙŠ */
        .timer-container {
            text-align: center;
            margin-bottom: 40px;
        }

        .timer-text {
            font-size: 100px;
            font-weight: 900;
            color: #ffffff;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.5);
            line-height: 1;
        }

        .timer-label {
            font-size: 20px;
            letter-spacing: 3px;
            text-transform: uppercase;
            margin-bottom: 10px;
            color: rgba(255, 255, 255, 0.8);
        }

        /* Ø§Ù„Ø³Ø¤Ø§Ù„ ÙˆØ§Ù„Ø®ÙŠØ§Ø±Ø§Øª */
        .question-glass {
            width: 70%;
            max-width: 1000px;
            padding: 40px;
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(20px);
            border-radius: 35px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }

        .q-text {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 40px;
            text-align: center;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .opt {
            padding: 25px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            font-size: 28px;
            transition: all 0.5s ease;
            text-align: center;
        }

        .correct-ans {
            background: #4caf50 !important; /* Ù„ÙˆÙ† Ø£Ø®Ø¶Ø± Ù„Ù„Ù†Ø¬Ø§Ø­ */
            border-color: #ffffff !important;
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(76, 175, 80, 0.8);
        }

        @keyframes glowPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 15px rgba(156, 39, 176, 0.5); }
            50% { transform: scale(1.05); box-shadow: 0 0 35px rgba(233, 30, 99, 0.8); }
        }

        .timer-warning {
            color: #ff5252 !important;
            animation: blink 0.5s infinite;
        }

        @keyframes blink {
            50% { opacity: 0.7; }
        }
    </style>
</head>

<body>
    <div class="main-background"></div>
    <audio id="beep-snd" src="https://www.soundjay.com/buttons/beep-01a.mp3"></audio>

    <div class="logo-fixed-container"><img src="logo.png" alt="Logo"></div>

    <div id="welcome-overlay" class="screen-layer">
        <div class="welcome-card">
            <h1 style="font-size:40px; margin-bottom:20px;">Challenge MÃ©dical ğŸ—ï¸</h1>
            <p style="font-size:24px; color: #fce4ec;">JournÃ©e Mondiale contre le Cancer</p>
            <div style="margin-top: 30px; font-style: italic; opacity: 0.8;">
                En attente du signal de l'administrateur...
            </div>
        </div>
    </div>

    <div id="quiz-interface" class="screen-layer">
        <div class="timer-container">
            <div class="timer-label" id="timer-status">PrÃ©parez-vous</div>
            <div class="timer-text" id="time-display">01:00</div>
        </div>

        <div class="question-glass">
            <div class="q-text" id="question-text">Le question s'affichera ici...</div>
            <div class="options-grid" id="options-container"></div>
        </div>
    </div>

    <script>
        const dbURL = "https://quiz-game-f3475-default-rtdb.firebaseio.com/";
        let currentStatus = "";
        let currentQId = null;
        let timerInterval;
        let answerShown = false;

        async function syncWithAdmin() {
            setInterval(async () => {
                try {
                    const res = await fetch(`${dbURL}gameStatus.json`);
                    const data = await res.json();

                    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù…Ù† Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
                    if (data.state === 'START_QUIZ' && currentStatus !== 'START_QUIZ') {
                        document.getElementById('welcome-overlay').style.opacity = '0';
                        setTimeout(() => {
                            document.getElementById('welcome-overlay').style.display = 'none';
                            document.getElementById('quiz-interface').classList.add('active');
                        }, 1000);
                        currentStatus = 'START_QUIZ';
                    }

                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                    if (data.currentQuestion && data.currentQuestion.id !== currentQId) {
                        currentQId = data.currentQuestion.id;
                        answerShown = false;
                        displayQuestion(data.currentQuestion);
                    }

                    // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙˆÙ‚Øª
                    if (data.timerStartTime && currentQId !== null) {
                        const serverStartTime = data.timerStartTime;
                        startSynchronizedTimer(serverStartTime, 60, data.currentQuestion.correctIndex);
                    }
                } catch (e) {
                    console.error('Sync error:', e);
                }
            }, 500);
        }

        function displayQuestion(q) {
            document.getElementById('question-text').innerText = q.text;
            const container = document.getElementById('options-container');
            container.innerHTML = "";
            q.options.forEach((opt, i) => {
                const div = document.createElement('div');
                div.className = 'opt';
                div.id = `opt-${i}`;
                div.innerText = opt;
                container.appendChild(div);
            });
            document.getElementById('timer-status').innerText = "Temps Restant";
        }

        function startSynchronizedTimer(startTimestamp, duration, correctIdx) {
            if (answerShown) return;

            clearInterval(timerInterval);
            const display = document.getElementById('time-display');

            timerInterval = setInterval(() => {
                const now = Date.now();
                const elapsed = Math.floor((now - startTimestamp) / 1000);
                const timeLeft = Math.max(0, duration - elapsed);

                const mins = Math.floor(timeLeft / 60).toString().padStart(2, '0');
                const secs = (timeLeft % 60).toString().padStart(2, '0');
                display.innerText = `${mins}:${secs}`;

                // ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ Ø§Ù„Ø£Ø®ÙŠØ±Ø©
                if (timeLeft <= 10) display.classList.add('timer-warning');
                else display.classList.remove('timer-warning');

                if (timeLeft <= 5 && timeLeft > 0) {
                    document.getElementById('beep-snd').play().catch(() => {});
                }

                // Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
                if (timeLeft <= 0 && !answerShown) {
                    answerShown = true;
                    clearInterval(timerInterval);
                    revealAnswer(correctIdx);
                }
            }, 100);
        }

        function revealAnswer(correctIdx) {
            const optEl = document.getElementById(`opt-${correctIdx}`);
            if (optEl) {
                optEl.classList.add('correct-ans');
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#ffffff', '#9c27b0', '#e91e63']
                });
            }
        }

        syncWithAdmin();
    </script>
</body>
</html>
