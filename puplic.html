<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <title>Ø´Ø§Ø´Ø© Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± ğŸ—ï¸</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #ad1457 0%, #d81b60 100%);
            color: white;
            font-family: 'Cairo', sans-serif;
            text-align: center;
            padding: 40px;
            min-height: 100vh;
            margin: 0;
        }

        #timer {
            font-size: 150px;
            color: #ffeb3b;
            font-weight: bold;
            margin: 10px;
            text-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
        }

        .card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            padding: 50px;
            border-radius: 40px;
            border: 5px solid white;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        }

        .q-text {
            font-size: 70px;
            margin-bottom: 50px;
            line-height: 1.3;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .opt {
            font-size: 45px;
            padding: 30px;
            border: 4px solid #f48fb1;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.1);
            transition: 0.6s ease;
        }

        .correct {
            background: #4caf50 !important;
            border-color: #a5d6a7 !important;
            transform: scale(1.1);
            box-shadow: 0 0 50px #4caf50;
        }

        #winner {
            font-size: 110px;
            color: #ffeb3b;
            display: block;
            margin: 40px;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }
    </style>
</head>

<body>
    <audio id="tick" src="https://www.soundjay.com/buttons/sounds/button-3.mp3"></audio>
    <audio id="bell" src="https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3"></audio>
    <audio id="cheer" src="https://www.soundjay.com/human/sounds/applause-01.mp3"></audio>

    <div class="card" id="main-card">
        <div id="timer">60</div>
        <div class="q-text" id="q-text">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨Ø¯Ø¡... ğŸ—ï¸</div>
        <div class="grid" id="options"></div>
        <div id="status" style="font-size: 30px; margin-top: 30px; color: #fce4ec;"></div>
    </div>

    <script>
        const dbURL = "https://quiz-game-f3475-default-rtdb.firebaseio.com/";
        let lastStep = -1, timer;
        const questions = [
            { q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø³Ù† Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡ Ù„Ù„Ù…Ø§Ù…ÙˆØºØ±Ø§ÙÙŠØ§ØŸ", opts: ["20 Ø³Ù†Ø©", "30 Ø³Ù†Ø©", "40 Ø³Ù†Ø©", "50 Ø³Ù†Ø©"], c: 2 },
            { q: "Ø£ÙØ¶Ù„ ØºØ°Ø§Ø¡ Ù„Ù„ÙˆÙ‚Ø§ÙŠØ©ØŸ", opts: ["Ø§Ù„Ø­Ù„ÙˆÙŠØ§Øª", "Ø§Ù„Ø®Ø¶Ø±ÙˆØ§Øª Ø§Ù„ÙˆØ±Ù‚ÙŠØ©", "Ø§Ù„Ù…Ù‚Ù„ÙŠØ§Øª", "Ø§Ù„Ù…Ø¹Ù„Ø¨Ø§Øª"], c: 1 },
            { q: "Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„ÙØ­Øµ Ø§Ù„Ø°Ø§ØªÙŠ Ø´Ù‡Ø±ÙŠØ§Ù‹ØŸ", opts: ["Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©", "Ù…Ø±ØªÙŠÙ†", "Ø£Ø±Ø¨Ø¹ Ù…Ø±Ø§Øª", "Ù„Ø§ ÙŠÙ‡Ù…"], c: 0 },
            { q: "Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù„Ù„ØªÙˆØ¹ÙŠØ©ØŸ", opts: ["Ø£Ø²Ø±Ù‚", "Ø£Ø­Ù…Ø±", "ÙˆØ±Ø¯ÙŠ", "Ø£ØµÙØ±"], c: 2 },
            { q: "Ù‡Ù„ Ø§Ù„Ø±ÙŠØ§Ø¶Ø© ØªÙ‚Ù„Ù„ Ø§Ù„Ø®Ø·Ø±ØŸ", opts: ["Ù„Ø§", "Ù†Ø¹Ù… Ø¨Ø§Ù„ØªØ£ÙƒÙŠØ¯", "Ù‚Ù„ÙŠÙ„Ø§Ù‹", "ÙÙ‚Ø· Ù„Ù„Ù…Ø­ØªØ±ÙÙŠÙ†"], c: 1 },
            { q: "Ø´Ù‡Ø± Ø§Ù„ØªÙˆØ¹ÙŠØ© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØŸ", opts: ["Ø¬Ø§Ù†ÙÙŠ", "Ø¬ÙˆØ§Ù†", "Ø£ÙƒØªÙˆØ¨Ø±", "Ø¯ÙŠØ³Ù…Ø¨Ø±"], c: 2 },
            { q: "Ø£ÙˆÙ„ Ø®Ø·ÙˆØ© Ø¹Ù†Ø¯ Ø§Ù„Ø´ÙƒØŸ", opts: ["Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±", "Ø§Ù„Ø·Ø¨ÙŠØ¨ ÙÙˆØ±Ø§Ù‹", "Ø§Ù„Ø£Ø¹Ø´Ø§Ø¨", "Ø§Ù„ØªØ¬Ø§Ù‡Ù„"], c: 1 },
            { q: "ÙˆØ³ÙŠÙ„Ø© Ø§Ù„ÙƒØ´Ù Ø§Ù„Ø£Ø¯Ù‚ØŸ", opts: ["Ø§Ù„Ù„Ù…Ø³ ÙÙ‚Ø·", "Ø§Ù„Ù…Ø§Ù…ÙˆØºØ±Ø§ÙÙŠØ§", "Ø§Ù„Ù†Ø¸Ø±", "Ø§Ù„ÙˆØ²Ù†"], c: 1 },
            { q: "Ù†Ø³Ø¨Ø© Ø§Ù„Ø´ÙØ§Ø¡ Ø¨Ø§Ù„ÙƒØ´Ù Ø§Ù„Ù…Ø¨ÙƒØ±ØŸ", opts: ["90%", "10%", "50%", "Ù„Ø§ ØªÙˆØ¬Ø¯"], c: 0 },
            { q: "Ø´Ø¹Ø§Ø± Ø§Ù„Ø£Ù…Ù„ ÙˆØ§Ù„ØªØ­Ø¯ÙŠ Ù‡ÙˆØŸ", opts: ["Ø£ÙƒØªÙˆØ¨Ø± Ø§Ù„ÙˆØ±Ø¯ÙŠ", "Ø§Ù„Ù‚ÙˆØ©", "Ø§Ù„Ø­ÙŠØ§Ø©", "Ù†Ø­Ù† Ù…Ø¹ÙƒÙ"], c: 0 }
        ];

        setInterval(async () => {
            const r = await fetch(`${dbURL}state.json`);
            const s = await r.json();
            if (s && s.step > lastStep) {
                lastStep = s.step;
                if (lastStep < 10) showQ(lastStep);
                else showWinner();
            } else if (s && s.reset) location.reload();
        }, 2000);

        function showQ(idx) {
            const q = questions[idx];
            document.getElementById('q-text').innerText = q.q;
            document.getElementById('status').innerText = "Ø§Ù„Ù„Ø§Ø¹Ø¨Ø§Øª ÙŠØ¬Ø§ÙˆØ¨Ù† Ø§Ù„Ø¢Ù†...";
            const div = document.getElementById('options');
            div.innerHTML = "";
            q.opts.forEach((o, i) => div.innerHTML += `<div class="opt" id="opt-${i}">${o}</div>`);
            startTimer(q.c);
        }

        function startTimer(correctIdx) {
            let left = 60;
            clearInterval(timer);
            timer = setInterval(() => {
                left--;
                document.getElementById('timer').innerText = left;
                if (left <= 10 && left > 0) document.getElementById('tick').play();
                if (left <= 0) {
                    clearInterval(timer);
                    document.getElementById('bell').play();
                    document.getElementById('status').innerText = "Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª! ØªØ±Ù‚Ø¨ÙˆØ§ Ø§Ù„Ø­Ù„...";
                    setTimeout(() => {
                        document.getElementById(`opt-${correctIdx}`).classList.add('correct');
                        document.getElementById('status').innerText = "Ù‡Ø°Ù‡ Ù‡ÙŠ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© âœ…";
                    }, 20000); // 20 Ø«Ø§Ù†ÙŠØ© ØªØ´ÙˆÙŠÙ‚
                }
            }, 1000);
        }

        async function showWinner() {
            const res = await fetch(`${dbURL}players.json`);
            const data = await res.json();
            const winner = Object.entries(data).sort((a, b) => b[1].score - a[1].score || a[1].lastUpdate - b[1].lastUpdate)[0];
            document.getElementById('main-card').innerHTML = `<h1>ğŸ† Ø¨Ø·Ù„Ø© Ø§Ù„ØªÙˆØ¹ÙŠØ© Ù‡ÙŠ:</h1><span id="winner">${winner[0]}</span><p style='font-size:40px'>Ø£Ù„Ù Ù…Ø¨Ø±ÙˆÙƒ! ğŸ‰ğŸ—ï¸</p>`;
            document.getElementById('cheer').play();
            confetti({ particleCount: 300, spread: 100, origin: { y: 0.5 } });
        }
    </script>
</body>

</html>