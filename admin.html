<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - ÙƒÙ†Ø²Ø© ğŸ—ï¸</title>
    <style>
        body {
            font-family: sans-serif;
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .controls {
            background: #34495e;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 15px 30px;
            font-size: 18px;
            margin: 10px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
        }

        .next {
            background: #27ae60;
        }

        .reset {
            background: #e74c3c;
        }

        #leaderboard {
            background: white;
            color: #333;
            padding: 20px;
            border-radius: 10px;
            max-width: 500px;
            margin: auto;
        }

        .user-row {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
    </style>
</head>

<body>
    <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ğŸ—ï¸</h1>
    <div class="controls">
        <h2 id="status">Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¨Ø¯Ø¡</h2>
        <button class="btn next" onclick="triggerNext()">Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ â¡ï¸</button>
        <button class="btn reset" onclick="resetAll()">ØªØµÙÙŠØ± Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ğŸ”„</button>
    </div>
    <div id="leaderboard">
        <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</h3>
        <div id="users-list">Ø§Ù†ØªØ¸Ø§Ø± Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚Ø§Øª...</div>
    </div>

    <script>
        const dbURL = "https://quiz-game-f3475-default-rtdb.firebaseio.com/";
        let currentStep = -1;

        async function triggerNext() {
            currentStep++;
            await fetch(`${dbURL}gameState.json`, {
                method: 'PUT',
                body: JSON.stringify({ started: true, currentStep: currentStep, reset: false })
            });
            document.getElementById('status').innerText = `Ø¬Ø§Ø±ÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø±Ù‚Ù…: ${currentStep + 1}`;
        }

        async function resetAll() {
            if (confirm("Ù‡Ù„ Ø£Ù†ØªÙ Ù…ØªØ£ÙƒØ¯Ø©ØŸ")) {
                await fetch(`${dbURL}.json`, { method: 'DELETE' });
                await fetch(`${dbURL}gameState.json`, {
                    method: 'PUT',
                    body: JSON.stringify({ started: false, currentStep: -1, reset: true })
                });
                location.reload();
            }
        }

        setInterval(async () => {
            const res = await fetch(`${dbURL}results.json`);
            const data = await res.json();
            const list = document.getElementById('users-list');
            if (!data) { list.innerHTML = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ØªØ³Ø§Ø¨Ù‚Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹"; return; }
            list.innerHTML = "";
            const sorted = Object.entries(data).sort((a, b) => b[1].score - a[1].score);
            sorted.forEach(([name, info]) => {
                list.innerHTML += `<div class="user-row"><span>${name}</span><span><strong>${info.score} Ù†Ù‚Ø·Ø©</strong></span></div>`;
            });
        }, 3000);
    </script>
</body>

</html>