<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… ÙƒÙ†Ø²Ø© ğŸ—ï¸</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background: #1a1a1a;
            color: white;
            text-align: center;
            padding: 30px;
        }

        .box {
            background: #2c2c2c;
            padding: 25px;
            border-radius: 20px;
            margin: 20px auto;
            max-width: 600px;
            border: 1px solid #9c27b0;
        }

        .btn {
            padding: 18px 35px;
            font-size: 22px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            color: white;
            margin: 10px;
            font-weight: bold;
            transition: 0.3s;
            width: 80%;
        }

        .start-btn {
            background: #4caf50;
            box-shadow: 0 5px 0 #2e7d32;
        }

        .next-btn {
            background: #9c27b0;
            box-shadow: 0 5px 0 #6a1b9a;
        }

        .reset {
            background: #e74c3c;
            font-size: 16px;
            margin-top: 50px;
            opacity: 0.7;
        }

        .player-row {
            background: #333;
            color: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            border: 1px solid #444;
        }

        .score-badge {
            background: #e91e63;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
        }
    </style>
</head>

<body>
    <h1>Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ğŸ—ï¸</h1>

    <div class="box">
        <h2 id="status-txt">Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¢Ù†: ØªØ±Ø­ÙŠØ¨</h2>
        <button class="btn start-btn" id="start-btn" onclick="triggerStart()">ğŸš€ Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© (Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ±Ø­ÙŠØ¨)</button>

        <hr style="border: 0.5px solid #444; margin: 20px 0;">

        <button class="btn next-btn" onclick="sendNextQuestion()">Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ â¡ï¸</button>
    </div>

    <div class="box">
        <h3>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚Ø§Øª (Ù…Ø¨Ø§Ø´Ø±):</h3>
        <div id="players-list">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ØªØ³Ø§Ø¨Ù‚Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</div>
    </div>

    <button class="btn reset" onclick="resetGame()">ğŸ”„ ØªØµÙÙŠØ± Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</button>

    <script>
        const dbURL = "https://quiz-game-f3475-default-rtdb.firebaseio.com/";
        let currentQIndex = 0;

        // Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù€ 10 Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©
        const questions = [
            { id: 1, text: "Quel est l'Ã¢ge recommandÃ© pour la premiÃ¨re mammographie ?", options: ["20 ans", "30 ans", "40 ans", "50 ans"], correctIndex: 2 },
            { id: 2, text: "L'activitÃ© physique rÃ©duit le risque de cancer ?", options: ["Vrai", "Faux", "Peu probable", "Aucun lien"], correctIndex: 0 },
            // ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù‡Ù†Ø§ Ø¨Ù†ÙØ³ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚
        ];

        // 1. Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© (ÙŠØ®ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø¹Ù†Ø¯ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±)
        async function triggerStart() {
            await fetch(`${dbURL}gameStatus.json`, {
                method: 'PATCH',
                body: JSON.stringify({ state: 'START_QUIZ' })
            });
            document.getElementById('status-txt').innerText = "Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¢Ù†: Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£ÙˆÙ„";
            document.getElementById('start-btn').style.display = 'none';
            sendNextQuestion(); // Ø¥Ø±Ø³Ø§Ù„ Ø£ÙˆÙ„ Ø³Ø¤Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        }

        // 2. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ
        async function sendNextQuestion() {
            if (currentQIndex < questions.length) {
                const questionData = questions[currentQIndex];
                await fetch(`${dbURL}gameStatus.json`, {
                    method: 'PATCH',
                    body: JSON.stringify({ currentQuestion: questionData })
                });
                document.getElementById('status-txt').innerText = "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø±Ù‚Ù…: " + (currentQIndex + 1);
                currentQIndex++;
            } else {
                alert("Ø§Ù†ØªÙ‡Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©!");
            }
        }

        // 3. ØªØµÙÙŠØ± Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
        async function resetGame() {
            if (confirm("Ø³ÙŠØªÙ… Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ù‡Ù„ Ø£Ù†ØªÙ Ù…ØªØ£ÙƒØ¯Ø©ØŸ")) {
                await fetch(`${dbURL}.json`, { method: 'DELETE' });
                location.reload();
            }
        }

        // 4. ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† (Leaderboard)
        setInterval(async () => {
            try {
                const res = await fetch(`${dbURL}players.json`);
                const data = await res.json();
                const list = document.getElementById('players-list');
                list.innerHTML = "";
                if (data) {
                    Object.entries(data).forEach(([name, info]) => {
                        list.innerHTML += `<div class="player-row"><span>ğŸ‘©â€ğŸ’¼ ${name}</span><span class="score-badge">${info.score} Ù†Ù‚Ø·Ø©</span></div>`;
                    });
                }
            } catch (e) { }
        }, 2000);
    </script>
</body>

</html>