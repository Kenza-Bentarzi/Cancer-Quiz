<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ­Ø¯ÙŠ Ø£ÙƒØªÙˆØ¨Ø± Ø§Ù„ÙˆØ±Ø¯ÙŠ ğŸ—ï¸</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --pink: #e91e63;
            --bg: #fff5f8;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: var(--bg);
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            background: white;
            width: 90%;
            max-width: 400px;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(233, 30, 99, 0.15);
            text-align: center;
        }

        .option {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 12px 0;
            border: 2px solid #fce4ec;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: 0.3s;
            font-weight: bold;
            font-size: 16px;
            text-align: center;
        }

        .option.selected {
            background: var(--pink) !important;
            color: white;
            border-color: var(--pink);
        }

        .option:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }

        #timer-bar {
            width: 100%;
            height: 8px;
            background: #eee;
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        #progress {
            width: 100%;
            height: 100%;
            background: var(--pink);
            transition: 1s linear;
        }

        h1 {
            color: var(--pink);
            font-size: 24px;
        }

        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #fce4ec;
            border-radius: 10px;
            margin-bottom: 15px;
            box-sizing: border-box;
        }

        .btn-main {
            background: var(--pink);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            width: 100%;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="container" id="app">
        <div id="login-screen">
            <h1>ğŸ—ï¸ Ø³Ø¬Ù„Ù‘ÙŠ Ø§Ø³Ù…ÙƒÙ</h1>
            <input type="text" id="username" placeholder="Ø§ÙƒØªØ¨ÙŠ Ø§Ø³Ù…ÙƒÙ Ù‡Ù†Ø§...">
            <button class="btn-main" onclick="register()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</button>
        </div>

        <div id="quiz-screen" style="display:none;">
            <div id="timer-bar">
                <div id="progress"></div>
            </div>
            <h3 id="q-text" style="color: #333;"></h3>
            <div id="options-container"></div>
        </div>

        <div id="waiting-screen" style="display:none;">
            <h2 id="wait-msg" style="color: var(--pink);">Ø§Ù†ØªØ¸Ø±ÙŠ Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø¨Ø¯Ø¡...</h2>
            <p>Ø³ÙŠØ¨Ø¯Ø£ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ Ù‚Ø±ÙŠØ¨Ø§Ù‹</p>
        </div>
    </div>

    <script>
        const dbURL = "https://quiz-game-f3475-default-rtdb.firebaseio.com/";
        let user = "", score = 0, lastStep = -1, timer;
        const questions = [
            { q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø³Ù† Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡ Ù„Ù„Ù…Ø§Ù…ÙˆØºØ±Ø§ÙÙŠØ§ØŸ", opts: ["20 Ø³Ù†Ø©", "30 Ø³Ù†Ø©", "40 Ø³Ù†Ø©", "50 Ø³Ù†Ø©"], c: 2 },
            { q: "Ø£ÙØ¶Ù„ ØºØ°Ø§Ø¡ Ù„Ù„ÙˆÙ‚Ø§ÙŠØ©ØŸ", opts: ["Ø§Ù„Ø­Ù„ÙˆÙŠØ§Øª", "Ø§Ù„Ø®Ø¶Ø±ÙˆØ§Øª Ø§Ù„ÙˆØ±Ù‚ÙŠØ©", "Ø§Ù„Ù…Ù‚Ù„ÙŠØ§Øª", "Ø§Ù„Ù…Ø¹Ù„Ø¨Ø§Øª"], c: 1 },
            { q: "Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„ÙØ­Øµ Ø§Ù„Ø°Ø§ØªÙŠ Ø´Ù‡Ø±ÙŠØ§Ù‹ØŸ", opts: ["Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©", "Ù…Ø±ØªÙŠÙ†", "Ø£Ø±Ø¨Ø¹ Ù…Ø±Ø§Øª", "Ù„Ø§ ÙŠÙ‡Ù…"], c: 0 },
            { q: "Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù„Ù„ØªÙˆØ¹ÙŠØ©ØŸ", opts: ["Ø£Ø²Ø±Ù‚", "Ø£Ø­Ù…Ø±", "ÙˆØ±Ø¯ÙŠ", "Ø£ØµÙØ±"], c: 2 },
            { q: "Ù‡Ù„ Ø§Ù„Ø±ÙŠØ§Ø¶Ø© ØªÙ‚Ù„Ù„ Ø§Ù„Ø®Ø·Ø±ØŸ", opts: ["Ù„Ø§", "Ù†Ø¹Ù… Ø¨Ø§Ù„ØªØ£ÙƒÙŠØ¯", "Ù‚Ù„ÙŠÙ„Ø§Ù‹", "ÙÙ‚Ø· Ù„Ù„Ù…Ø­ØªØ±ÙÙŠÙ†"], c: 1 },
            { q: "Ø´Ù‡Ø± Ø§Ù„ØªÙˆØ¹ÙŠØ© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØŸ", opts: ["Ø¬Ø§Ù†ÙÙŠ", "Ø¬ÙˆØ§Ù†", "Ø£ÙƒØªÙˆØ¨Ø±", "Ø¯ÙŠØ³Ù…Ø¨Ø±"], c: 2 },
            { q: "Ø£ÙˆÙ„ Ø®Ø·ÙˆØ© Ø¹Ù†Ø¯ Ø§Ù„Ø´ÙƒØŸ", opts: ["Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±", "Ø§Ù„Ø·Ø¨ÙŠØ¨ ÙÙˆØ±Ø§Ù‹", "Ø§Ù„Ø£Ø¹Ø´Ø§Ø¨", "Ø§Ù„ØªØ¬Ø§Ù‡Ù„"], c: 1 },
            { q: "ÙˆØ³ÙŠÙ„Ø© Ø§Ù„ÙƒØ´Ù Ø§Ù„Ø£Ø¯Ù‚ØŸ", opts: ["Ø§Ù„Ù„Ù…Ø³ ÙÙ‚Ø·", "Ø§Ù„Ù…Ø§Ù…ÙˆØºØ±Ø§ÙÙŠØ§", "Ø§Ù„Ù†Ø¸Ø±", "Ø§Ù„ÙˆØ²Ù†"], c: 1 },
            { q: "Ù†Ø³Ø¨Ø© Ø§Ù„Ø´ÙØ§Ø¡ Ø¨Ø§Ù„ÙƒØ´Ù Ø§Ù„Ù…Ø¨ÙƒØ±ØŸ", opts: ["90%", "10%", "50%", "Ù„Ø§ ØªÙˆØ¬Ø¯"], c: 0 },
            { q: "Ø´Ø¹Ø§Ø± Ø§Ù„Ø£Ù…Ù„ ÙˆØ§Ù„ØªØ­Ø¯ÙŠ Ù‡ÙˆØŸ", opts: ["Ø£ÙƒØªÙˆØ¨Ø± Ø§Ù„ÙˆØ±Ø¯ÙŠ", "Ø§Ù„Ù‚ÙˆØ©", "Ø§Ù„Ø­ÙŠØ§Ø©", "Ù†Ø­Ù† Ù…Ø¹ÙƒÙ"], c: 0 }
        ];

        async function register() {
            user = document.getElementById('username').value.trim();
            if (!user) return alert("Ù…Ù† ÙØ¶Ù„ÙƒÙ Ø§ÙƒØªØ¨ÙŠ Ø§Ø³Ù…ÙƒÙ");
            await fetch(`${dbURL}players/${user}.json`, { method: 'PUT', body: JSON.stringify({ score: 0, lastUpdate: Date.now() }) });
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('waiting-screen').style.display = 'block';
            listen();
        }

        function listen() {
            setInterval(async () => {
                const r = await fetch(`${dbURL}state.json`);
                const s = await r.json();
                if (s && s.step > lastStep) {
                    lastStep = s.step;
                    if (lastStep < 10) showQ(lastStep);
                    else showEnd();
                } else if (s && s.reset) location.reload();
            }, 2000);
        }

        function showQ(idx) {
            document.getElementById('waiting-screen').style.display = 'none';
            document.getElementById('quiz-screen').style.display = 'block';
            const q = questions[idx];
            document.getElementById('q-text').innerText = q.q;
            const container = document.getElementById('options-container');
            container.innerHTML = "";
            q.opts.forEach((o, i) => {
                container.innerHTML += `<button class="option" onclick="answer(${idx}, ${i}, this)">${o}</button>`;
            });
            startTimer();
        }

        function startTimer() {
            let left = 60;
            const bar = document.getElementById('progress');
            bar.style.width = "100%";
            clearInterval(timer);
            timer = setInterval(() => {
                left--;
                bar.style.width = (left / 60) * 100 + "%";
                if (left <= 0) {
                    clearInterval(timer);
                    disableAll();
                    setTimeout(() => {
                        document.getElementById('quiz-screen').style.display = 'none';
                        document.getElementById('waiting-screen').style.display = 'block';
                    }, 2000);
                }
            }, 1000);
        }

        function disableAll() {
            const btns = document.querySelectorAll('.option');
            btns.forEach(b => b.disabled = true);
        }

        async function answer(qIdx, oIdx, btn) {
            clearInterval(timer);
            disableAll();
            btn.classList.add('selected');
            if (oIdx === questions[qIdx].c) score += 10;
            await fetch(`${dbURL}players/${user}.json`, { method: 'PATCH', body: JSON.stringify({ score: score, lastUpdate: Date.now() }) });
            setTimeout(() => {
                document.getElementById('quiz-screen').style.display = 'none';
                document.getElementById('waiting-screen').style.display = 'block';
            }, 1000);
        }

        function showEnd() {
            document.getElementById('app').innerHTML = `<h1>ğŸ‰ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠ</h1><h3>Ù†Ù‚Ø§Ø·ÙƒÙ: ${score}</h3><p>Ø´ÙƒØ±Ø§Ù‹ Ù„ÙˆØ¹ÙŠÙƒÙ ğŸ—ï¸</p>`;
        }
    </script>
</body>

</html>