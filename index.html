<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ­Ø¯ÙŠ Ø§Ù„Ø£Ù…Ù„ - Ù…Ø³Ø§Ø¨Ù‚Ø© Ø£ÙƒØªÙˆØ¨Ø± Ø§Ù„ÙˆØ±Ø¯ÙŠ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #fff0f5;
            text-align: center;
            color: #d81b60;
            margin: 0;
            padding: 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            margin: auto;
        }

        .btn {
            background-color: #e91e63;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 18px;
            margin: 10px;
        }

        .option {
            display: block;
            background: #fce4ec;
            margin: 10px 0;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            border: 2px solid transparent;
            font-weight: bold;
        }

        .option:hover {
            border-color: #e91e63;
            background-color: #f8bbd0;
        }

        #quiz-screen,
        #result-screen,
        #waiting-screen {
            display: none;
        }
    </style>
</head>

<body>
    <div class="card">
        <h1>ğŸ—ï¸ ØªØ­Ø¯ÙŠ Ø§Ù„Ø£Ù…Ù„</h1>

        <div id="login-screen">
            <p>Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ ÙÙŠ Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„ØªÙˆØ¹ÙŠØ©!</p>
            <input type="text" id="username" placeholder="Ø§ÙƒØªØ¨ÙŠ Ø§Ø³Ù…ÙƒÙ Ù‡Ù†Ø§..."
                style="padding: 12px; width: 80%; border-radius: 10px; border: 1px solid #ddd; font-size: 16px;"><br>
            <button class="btn" onclick="registerUser()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</button>
        </div>

        <div id="waiting-screen">
            <h3 id="waiting-msg">ØªÙ… ØªØ³Ø¬ÙŠÙ„ÙƒÙ Ø¨Ù†Ø¬Ø§Ø­ âœ…</h3>
            <p>ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ØªØ¹Ø·ÙŠ Ø§Ù„Ù…Ù†Ø¸Ù…Ø© Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø¨Ø¯Ø¡...</p>
            <div style="font-size: 40px;">â³</div>
        </div>

        <div id="quiz-screen">
            <h2 id="question-text">Ø§Ù„Ø³Ø¤Ø§Ù„ ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§</h2>
            <div id="options-container"></div>
        </div>

        <div id="result-screen">
            <h2>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©! ğŸ‰</h2>
            <p id="final-score" style="font-size: 24px; font-weight: bold;"></p>
            <p>Ø´ÙƒØ±Ø§Ù‹ Ù„Ù…Ø´Ø§Ø±ÙƒØªÙƒÙ ÙÙŠ Ù†Ø´Ø± Ø§Ù„ÙˆØ¹ÙŠ ğŸ—ï¸</p>
        </div>
    </div>

    <script>
        const dbURL = "https://quiz-game-f3475-default-rtdb.firebaseio.com/";
        let currentUser = "";
        let currentScore = 0;
        let lastStepSeen = -1;

        const questions = [
            { q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù„Ø´Ù‡Ø± Ø£ÙƒØªÙˆØ¨Ø± Ø§Ù„ÙˆØ±Ø¯ÙŠØŸ", options: ["Ø§Ù„ÙˆØ±Ø¯ÙŠ", "Ø§Ù„Ø£Ø²Ø±Ù‚", "Ø§Ù„Ø£Ø­Ù…Ø±"], correct: 0 },
            { q: "Ù‡Ù„ Ø§Ù„ÙƒØ´Ù Ø§Ù„Ù…Ø¨ÙƒØ± ÙŠØ²ÙŠØ¯ ÙØ±Øµ Ø§Ù„Ø´ÙØ§Ø¡ØŸ", options: ["Ù†Ø¹Ù…", "Ù„Ø§", "Ø±Ø¨Ù…Ø§"], correct: 0 },
            { q: "Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶Ø© Ø§Ù„Ø£Ø³Ù‡Ù„ Ù„Ù„ÙˆÙ‚Ø§ÙŠØ©ØŸ", options: ["Ø§Ù„Ù…Ø´ÙŠ", "Ø§Ù„Ø³Ø¨Ø§Ø­Ø©", "Ø§Ù„Ø±ÙƒØ¶"], correct: 0 },
            { q: "Ø§Ù„ØºØ°Ø§Ø¡ Ø§Ù„ØµØ­ÙŠ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ«ÙŠØ± Ù…Ù†..ØŸ", options: ["Ø§Ù„Ø³ÙƒØ±ÙŠØ§Øª", "Ø§Ù„Ø®Ø¶Ø±ÙˆØ§Øª", "Ø§Ù„Ø¯Ù‡ÙˆÙ†"], correct: 1 },
            { q: "ÙƒÙ… Ù…Ø±Ø© ÙŠÙØ¶Ù„ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø°Ø§ØªÙŠØŸ", options: ["ÙƒÙ„ Ø³Ù†Ø©", "ÙƒÙ„ Ø´Ù‡Ø±", "ÙƒÙ„ ÙŠÙˆÙ…"], correct: 1 },
            { q: "Ø§Ù„ÙØ­Øµ Ø§Ù„Ø³Ù†ÙˆÙŠ Ø¨Ø§Ù„Ù…Ø§Ù…ÙˆØºØ±Ø§ÙÙŠØ§ ÙŠØ¨Ø¯Ø£ ØºØ§Ù„Ø¨Ø§Ù‹ Ù…Ù† Ø³Ù†..ØŸ", options: ["20 Ø³Ù†Ø©", "40 Ø³Ù†Ø©", "60 Ø³Ù†Ø©"], correct: 1 },
            { q: "Ù‡Ù„ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†ÙØ³ÙŠØ© Ù…Ù‡Ù…Ø© Ù„Ù„Ù…Ø±ÙŠØ¶ØŸ", options: ["Ù†Ø¹Ù… Ø¬Ø¯Ø§Ù‹", "Ù„ÙŠØ³ Ù„Ù‡Ø§ Ø¯ÙˆØ±", "Ù‚Ù„ÙŠÙ„Ø§Ù‹"], correct: 0 },
            { q: "Ø£ÙƒØªÙˆØ¨Ø± Ù‡Ùˆ Ø´Ù‡Ø± Ø§Ù„ØªÙˆØ¹ÙŠØ© Ø¨Ù…Ø±Ø¶ Ø³Ø±Ø·Ø§Ù†..ØŸ", options: ["Ø§Ù„Ø±Ø¦Ø©", "Ø§Ù„Ø«Ø¯ÙŠ", "Ø§Ù„Ø¬Ù„Ø¯"], correct: 1 },
            { q: "Ø£ÙŠÙ† Ù†ØªÙˆØ¬Ù‡ Ø¹Ù†Ø¯ Ø§ÙƒØªØ´Ø§Ù Ø£ÙŠ ÙƒØªÙ„Ø©ØŸ", options: ["Ù„Ù„Ø·Ø¨ÙŠØ¨ ÙÙˆØ±Ø§Ù‹", "Ù„Ù„ØµÙŠØ¯Ù„ÙŠØ©", "Ù„Ù„Ø¨ÙŠØª"], correct: 0 },
            { q: "Ø´Ø¹Ø§Ø±Ù†Ø§ Ø§Ù„ÙŠÙˆÙ… Ù‡Ùˆ 'Ø§Ù„Ø£Ù…Ù„ Ùˆ..'", options: ["Ø§Ù„Ø­Ø²Ù†", "Ø§Ù„ØªØ­Ø¯ÙŠ", "Ø§Ù„Ø®ÙˆÙ"], correct: 1 }
        ];

        async function registerUser() {
            currentUser = document.getElementById('username').value.trim();
            if (!currentUser) return alert("Ù…Ù† ÙØ¶Ù„ÙƒÙ Ø§Ø¯Ø®Ù„ÙŠ Ø§Ø³Ù…ÙƒÙ");
            await fetch(`${dbURL}results/${currentUser}.json`, {
                method: 'PUT',
                body: JSON.stringify({ score: 0, lastUpdate: Date.now() })
            });
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('waiting-screen').style.display = 'block';
            startListening();
        }

        function startListening() {
            setInterval(async () => {
                const res = await fetch(`${dbURL}gameState.json`);
                const state = await res.json();
                if (state && state.started) {
                    if (state.currentStep > lastStepSeen) {
                        lastStepSeen = state.currentStep;
                        if (lastStepSeen < questions.length) {
                            showQuestion(lastStepSeen);
                        } else { showResults(); }
                    }
                } else if (state && state.reset) { location.reload(); }
            }, 2000);
        }

        function showQuestion(index) {
            document.getElementById('waiting-screen').style.display = 'none';
            document.getElementById('quiz-screen').style.display = 'block';
            const q = questions[index];
            document.getElementById('question-text').innerText = q.q;
            const container = document.getElementById('options-container');
            container.innerHTML = "";
            q.options.forEach((opt, i) => {
                const div = document.createElement('div');
                div.className = "option";
                div.innerText = opt;
                div.onclick = () => selectAnswer(index, i);
                container.appendChild(div);
            });
        }

        async function selectAnswer(qIndex, oIndex) {
            if (oIndex === questions[qIndex].correct) { currentScore += 10; }
            await fetch(`${dbURL}results/${currentUser}.json`, {
                method: 'PATCH',
                body: JSON.stringify({ score: currentScore, lastUpdate: Date.now() })
            });
            document.getElementById('quiz-screen').style.display = 'none';
            document.getElementById('waiting-screen').style.display = 'block';
            document.getElementById('waiting-msg').innerText = "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø¬Ø§Ø¨ØªÙƒÙ âœ…";
        }

        function showResults() {
            document.getElementById('waiting-screen').style.display = 'none';
            document.getElementById('quiz-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';
            document.getElementById('final-score').innerText = `Ù†Ù‚Ø§Ø·ÙƒÙ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: ${currentScore}`;
        }
    </script>
</body>

</html>