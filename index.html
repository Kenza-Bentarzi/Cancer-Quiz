<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ­Ø¯ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</title>
    <style>
        body {
            font-family: sans-serif;
            background: #f4f7f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .card {
            background: white;
            width: 90%;
            max-width: 400px;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #6c5ce7;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            font-size: 16px;
            transition: 0.3s;
        }

        .btn:hover {
            background: #6c5ce7;
            color: white;
        }

        input {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
            text-align: center;
        }

        .hidden {
            display: none;
        }

        .waiting {
            color: #f39c12;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="card" id="app">
        <div id="login">
            <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! ğŸ‘‹</h2>
            <input type="text" id="pName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§...">
            <button class="btn" style="background:#6c5ce7; color:white;" onclick="checkRegistration()">Ø¯Ø®ÙˆÙ„</button>
        </div>

        <div id="waitRoom" class="hidden">
            <h3 class="waiting">ØªÙ… ØªØ³Ø¬ÙŠÙ„Ùƒ Ø¨Ù†Ø¬Ø§Ø­! âœ…</h3>
            <p>Ø§Ù†ØªØ¸Ø± Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚ Ù…Ù† Ø§Ù„Ø£Ø³ØªØ§Ø°Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©... â³</p>
        </div>

        <div id="quiz" class="hidden">
            <h3 id="qText">Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ</h3>
            <div id="options"></div>
        </div>

        <div id="end" class="hidden">
            <h2>Ø§Ù†ØªÙ‡ÙŠØª! ğŸ</h2>
            <p>ØªØ§Ø¨Ø¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰.</p>
        </div>
    </div>

    <script>
        const dbURL = "https://quiz-game-f3475-default-rtdb.firebaseio.com/";
        const questions = [
            { q: "Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ØŸ", opts: ["ÙˆÙ‡Ø±Ø§Ù†", "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±", "Ø¹Ù†Ø§Ø¨Ø©"], correct: 1 },
            { q: "2 + 2 * 2 ØªØ³Ø§ÙˆÙŠØŸ", opts: ["8", "4", "6"], correct: 2 },
            { q: "Ø£ÙƒØ¨Ø± Ù‚Ø§Ø±Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ", opts: ["Ø¥ÙØ±ÙŠÙ‚ÙŠØ§", "Ø¢Ø³ÙŠØ§", "Ø£ÙˆØ±ÙˆØ¨Ø§"], correct: 1 }
        ];

        let current = 0; let score = 0; let name = "";

        function checkRegistration() {
            name = document.getElementById('pName').value;
            if (!name) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ!");

            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙÙŠ Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ² Ø¨Ø³ÙƒÙˆØ± 0
            fetch(`${dbURL}results/${name}.json`, {
                method: 'PUT',
                body: JSON.stringify({ name: name, score: 0, lastAns: "ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±" })
            });

            document.getElementById('login').classList.add('hidden');
            document.getElementById('waitRoom').classList.remove('hidden');
            listenToStart();
        }

        function listenToStart() {
            const check = setInterval(() => {
                fetch(`${dbURL}gameState.json`).then(r => r.json()).then(state => {
                    if (state && state.started) {
                        clearInterval(check);
                        startQuiz();
                    }
                });
            }, 1000);
        }

        function startQuiz() {
            document.getElementById('waitRoom').classList.add('hidden');
            document.getElementById('quiz').classList.remove('hidden');
            showQ();
        }

        function showQ() {
            let q = questions[current];
            document.getElementById('qText').innerText = q.q;
            let optDiv = document.getElementById('options');
            optDiv.innerHTML = "";
            q.opts.forEach((o, i) => {
                let b = document.createElement('button');
                b.className = "btn"; b.innerText = o;
                b.onclick = () => checkAns(i, o);
                optDiv.appendChild(b);
            });
        }

        function checkAns(idx, choice) {
            if (idx === questions[current].correct) score++;
            fetch(`${dbURL}results/${name}.json`, {
                method: 'PUT',
                body: JSON.stringify({ name: name, score: score, lastAns: choice })
            });
            current++;
            if (current < questions.length) showQ();
            else {
                document.getElementById('quiz').classList.add('hidden');
                document.getElementById('end').classList.remove('hidden');
            }
        }
    </script>
</body>

</html>